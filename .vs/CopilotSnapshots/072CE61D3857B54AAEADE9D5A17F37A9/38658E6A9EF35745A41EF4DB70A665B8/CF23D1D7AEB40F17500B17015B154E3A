using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows.Forms;

namespace BaiTapCuoiKy
{
    public enum AppLanguage
    {
        Vietnamese,
        English
    }

    public static class LocalizationManager
    {
        private static AppLanguage _language = AppLanguage.Vietnamese;
        public static AppLanguage Language => _language;

        public static event Action LanguageChanged;

        // Dictionary-based simple localization. Keys are identifiers; values are per-language strings.
        private static readonly Dictionary<string, (string vi, string en)> _texts = new Dictionary<string, (string vi, string en)>
        {
            ["APP_TITLE"] = ("DrawMaster - Chào mừng", "DrawMaster - Welcome"),
            ["WELCOME_TITLE"] = ("🎨 DRAWMASTER PREMIUM 🎨", "🎨 DRAWMASTER PREMIUM 🎨"),
            ["WELCOME_SUBTITLE"] = ("🌟 Trải nghiệm Vẽ và Đoán nhiều người chơi 🌟", "🌟 Multiplayer Drawing & Guessing Experience 🌟"),
            ["WELCOME_HELLO"] = ("🎉 Chào mừng, {0}! 🎉", "🎉 Welcome, {0}! 🎉"),
            ["WELCOME_OPTIONS"] = ("🚀 Chọn một tùy chọn để bắt đầu cuộc phiêu lưu:", "🚀 Choose an option to start the adventure:"),
            ["BTN_CREATE_ROOM"] = ("🏆 TẠO PHÒNG MỚI", "🏆 CREATE ROOM"),
            ["BTN_JOIN"] = ("🚀 THAM GIA", "🚀 JOIN"),
            ["BTN_LOGOUT"] = ("🚪 ĐĂNG XUẤT", "🚪 LOG OUT"),
            ["LBL_JOIN_IP"] = ("Nhập IP phòng:", "Enter room IP:"),
            ["STATS_BRIEF"] = ("🎮 Trận đã chơi: 0  |  ⭐ Điểm cao nhất: 0  |  🏆 Thắng: 0", "🎮 Games: 0  |  ⭐ Best: 0  |  🏆 Wins: 0"),
            ["LOBBY_TITLE"] = ("LOBBY - PHÒNG: {0}", "LOBBY - ROOM: {0}"),
            ["LOBBY_PLAYERS"] = ("👥 Người chơi trong phòng", "👥 Players in room"),
            ["LOBBY_CHAT"] = ("💬 Chat sảnh chờ", "💬 Lobby chat"),
            ["BTN_LEAVE_LOBBY"] = ("🚪 Rời Lobby", "🚪 Leave Lobby"),
            ["BTN_INVITE"] = ("📧 Mời bạn bè", "📧 Invite friends"),
            ["BTN_START_GAME"] = ("🎮 BẮT ĐẦU GAME", "🎮 START GAME"),
            ["LOBBY_WAITING"] = ("Đang chờ người chơi...", "Waiting for players..."),
            ["LOBBY_READY"] = ("✅ Đủ người chơi - Có thể bắt đầu game!", "✅ Enough players - Ready to start!"),
            ["LOBBY_NEED_MORE"] = ("⏳ Cần thêm người chơi để bắt đầu...", "⏳ Need more players to start..."),
            ["INVITE_MESSAGE"] = ("🎮 Mời bạn bè tham gia game!\n\n📋 Địa chỉ kết nối: {0}\n🎯 Copy địa chỉ này và gửi cho bạn bè để họ có thể tham gia!", "🎮 Invite your friends!\n\n📋 Connection address: {0}\n🎯 Copy this address and share to let them join!"),
            ["COPIED_CLIPBOARD"] = ("📋 Địa chỉ kết nối đã được copy vào clipboard!", "📋 Connection address copied to clipboard!"),
            ["CONFIRM_LEAVE_LOBBY_TITLE"] = ("Xác nhận rời lobby", "Confirm leave lobby"),
            ["CONFIRM_LEAVE_LOBBY_MSG"] = ("Bạn có chắc chắn muốn rời khỏi lobby không?", "Are you sure you want to leave the lobby?"),
            ["NOT_ENOUGH_PLAYERS"] = ("Cần ít nhất 2 người chơi để bắt đầu game!", "At least 2 players are required to start!"),
            ["CONFIRM_START_TITLE"] = ("Xác nhận bắt đầu game", "Confirm start"),
            ["CONFIRM_START_MSG"] = ("🎮 Bắt đầu game với {0} người chơi?\n\n⚠️ Sau khi bắt đầu, không thể thêm người chơi mới!", "🎮 Start game with {0} players?\n\n⚠️ After starting, no new players can join!"),
            ["LANGUAGE"] = ("Ngôn ngữ:", "Language:"),
        };

        public static string Tr(string key)
        {
            if (_texts.TryGetValue(key, out var tuple))
            {
                return _language == AppLanguage.English ? tuple.en : tuple.vi;
            }
            return key;
        }

        public static string TrFormat(string key, params object[] args)
        {
            return string.Format(Tr(key), args);
        }

        public static void SetLanguage(AppLanguage lang)
        {
            if (_language != lang)
            {
                _language = lang;
                LanguageChanged?.Invoke();
            }
        }

        // Best-effort generic control tree translation using exact matches of Vietnamese defaults
        private static readonly Dictionary<string, string> _viToEn = new Dictionary<string, string>
        {
            {"🚪 Rời Lobby", "🚪 Leave Lobby"},
            {"📧 Mời bạn bè", "📧 Invite friends"},
            {"🎮 BẮT ĐẦU GAME", "🎮 START GAME"},
            {"Đang chờ người chơi...", "Waiting for players..."},
            {"💬 Chat sảnh chờ", "💬 Lobby chat"},
            {"👥 Người chơi trong phòng", "👥 Players in room"},
            {"🚪 ĐĂNG XUẤT", "🚪 LOG OUT"},
            {"🏆 TẠO PHÒNG MỚI", "🏆 CREATE ROOM"},
            {"🚀 THAM GIA", "🚀 JOIN"},
            {"Nhập IP phòng:", "Enter room IP:"},
        };

        public static void LocalizeContainer(Control root)
        {
            if (root == null) return;
            Action<Control> apply = null;
            apply = (ctrl) =>
            {
                if (!string.IsNullOrEmpty(ctrl.Text))
                {
                    if (_language == AppLanguage.English && _viToEn.TryGetValue(ctrl.Text, out var en))
                    {
                        ctrl.Text = en;
                    }
                    else if (_language == AppLanguage.Vietnamese && _viToEn.ContainsValue(ctrl.Text))
                    {
                        // map back by reverse lookup
                        var vi = _viToEn.FirstOrDefault(kv => kv.Value == ctrl.Text).Key;
                        if (!string.IsNullOrEmpty(vi)) ctrl.Text = vi;
                    }
                }
                foreach (Control child in ctrl.Controls) apply(child);
            };
            apply(root);
        }
    }
}
